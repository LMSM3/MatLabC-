#!/bin/bash
# Complete rebuild script with dependency installation

set -e

echo "???????????????????????????????????????????????????????????????????????????"
echo "  MatLabC++ Complete Build - With Dependency Installation"
echo "???????????????????????????????????????????????????????????????????????????"
echo ""

# Install dependencies
echo "Installing build dependencies..."
sudo apt update
sudo apt install -y build-essential cmake libcairo2-dev

echo ""
echo "Dependencies installed!"
echo ""

# Navigate to build directory
cd /mnt/c/Users/Liam/Desktop/MatLabC++

# Clean old build
echo "Cleaning previous build..."
rm -rf build
mkdir build
cd build

echo ""
echo "Configuring CMake..."
cmake -DCMAKE_BUILD_TYPE=Release ..

echo ""
echo "Building project..."
cmake --build . --config Release -j4

echo ""
echo "???????????????????????????????????????????????????????????????????????????"
echo "  Build Complete"
echo "???????????????????????????????????????????????????????????????????????????"
echo ""

if [ -f "matlabcpp" ] || [ -f "matlabcpp.exe" ]; then
    echo "? SUCCESS! Executable created"
    ls -lh matlabcpp* 2>/dev/null || ls -lh Release/matlabcpp* 2>/dev/null
    echo ""
    echo "Next steps:"
    echo "  cd ../v0.3.0"
    echo "  bash Setup-Bash-Integration.sh"
    echo "  source ~/.bashrc"
    echo "  mlcpp --version"
else
    echo "??  Build completed but executable not found"
    echo "Checking build directory..."
    ls -lah
fi

echo ""
