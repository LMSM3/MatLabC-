# v0.4.4 - Structural Mechanics Module

**Focus:** Add engineering mechanics functions for stress/strain analysis

---

## New Functions to Add

### Bending Stress
```matlab
>>> sigma = bending_stress(M_z, y, I_z, M_y, z, I_y)
% œÉ = -M_z*y/I_z + M_y*z/I_y
% Biaxial bending stress
```

### Torsional Shear Stress
```matlab
>>> tau_max = torsion_rect(T, w, t)
% œÑ_max ‚âà 3T/(w*t¬≤)
% Rectangular cross-section
```

### Second Moment of Area
```matlab
>>> I_z = moment_inertia_rect(b, h)
% I_z = b*h¬≥/12
% Rectangular section about z-axis

>>> I_circle = moment_inertia_circle(d)
% I = œÄ*d‚Å¥/64
% Circular section
```

### Combined Stress
```matlab
>>> sigma_vm = von_mises(sigma_x, sigma_y, tau_xy)
% Von Mises equivalent stress
% œÉ_vm = ‚àö(œÉ_x¬≤ - œÉ_x*œÉ_y + œÉ_y¬≤ + 3*œÑ_xy¬≤)
```

### Deflection
```matlab
>>> delta = beam_deflection(w, L, E, I)
% Œ¥_max = 5*w*L‚Å¥/(384*E*I)
% Simply supported beam, uniform load
```

---

## Implementation Files

### 1. Create `src/mechanics/stress.cpp`
```cpp
#include "matlabcpp/mechanics.hpp"
#include <cmath>

namespace matlabcpp {
namespace mechanics {

// Bending stress (biaxial)
double bending_stress(double M_z, double y, double I_z, 
                      double M_y, double z, double I_y) {
    return -M_z * y / I_z + M_y * z / I_y;
}

// Torsion - rectangular cross section
double torsion_rectangular(double T, double w, double t) {
    return 3.0 * T / (w * t * t);
}

// Second moment of area - rectangle
double moment_inertia_rect(double b, double h) {
    return b * h * h * h / 12.0;
}

// Second moment of area - circle
double moment_inertia_circle(double d) {
    return M_PI * pow(d, 4) / 64.0;
}

// Von Mises stress
double von_mises(double sigma_x, double sigma_y, double tau_xy) {
    return sqrt(sigma_x * sigma_x - sigma_x * sigma_y + 
                sigma_y * sigma_y + 3.0 * tau_xy * tau_xy);
}

// Beam deflection - simply supported, uniform load
double beam_deflection_uniform(double w, double L, double E, double I) {
    return 5.0 * w * pow(L, 4) / (384.0 * E * I);
}

} // namespace mechanics
} // namespace matlabcpp
```

### 2. Create `include/matlabcpp/mechanics.hpp`
```cpp
#pragma once

namespace matlabcpp {
namespace mechanics {

// Stress calculations
double bending_stress(double M_z, double y, double I_z, 
                      double M_y, double z, double I_y);
double torsion_rectangular(double T, double w, double t);
double von_mises(double sigma_x, double sigma_y, double tau_xy);

// Section properties
double moment_inertia_rect(double b, double h);
double moment_inertia_circle(double d);

// Deflections
double beam_deflection_uniform(double w, double L, double E, double I);

} // namespace mechanics
} // namespace matlabcpp
```

---

## Usage Examples

### Example 1: I-Beam Bending
```matlab
>>> % I-beam properties
>>> I_z = 1.2e-5  % m‚Å¥
>>> I_y = 3.4e-6  % m‚Å¥

>>> % Applied moments
>>> M_z = 50e3    % N¬∑m
>>> M_y = 20e3    % N¬∑m

>>> % Point of interest
>>> y = 0.15      % m from neutral axis
>>> z = 0.05      % m from neutral axis

>>> % Calculate bending stress
>>> sigma = bending_stress(M_z, y, I_z, M_y, z, I_y)
sigma = -61.8 MPa
```

### Example 2: Shaft Torsion
```matlab
>>> % Rectangular shaft
>>> T = 500       % N¬∑m torque
>>> w = 0.05      % m width
>>> t = 0.02      % m thickness

>>> % Maximum shear stress
>>> tau_max = torsion_rect(T, w, t)
tau_max = 75.0 MPa
```

### Example 3: Combined Loading
```matlab
>>> % Stress state at a point
>>> sigma_x = 100  % MPa
>>> sigma_y = -50  % MPa
>>> tau_xy = 30    % MPa

>>> % Von Mises equivalent stress
>>> sigma_vm = von_mises(sigma_x, sigma_y, tau_xy)
sigma_vm = 142.3 MPa
```

---

## Test Cases

### Test 1: Pure Bending (Uniaxial)
```matlab
% M_y = 0, should get classical œÉ = -M*y/I
M_z = 1000
y = 0.1
I_z = 1e-4
sigma = bending_stress(M_z, y, I_z, 0, 0, 1)
% Expected: -1000 * 0.1 / 1e-4 = -1e6 Pa = -1 MPa
```

### Test 2: Rectangular Section Properties
```matlab
b = 0.1  % 100mm
h = 0.2  % 200mm
I = moment_inertia_rect(b, h)
% Expected: 0.1 * 0.2¬≥ / 12 = 6.67e-5 m‚Å¥
```

### Test 3: Von Mises (Pure Shear)
```matlab
sigma_vm = von_mises(0, 0, 100)
% Expected: ‚àö(3*100¬≤) = 173.2 MPa
```

---

## Integration Steps

1. **Add to CMakeLists.txt:**
```cmake
add_library(matlabcpp_mechanics
    src/mechanics/stress.cpp
)

target_link_libraries(matlabcpp_mechanics
    PUBLIC matlabcpp_core
)
```

2. **Register functions in interpreter:**
```cpp
// In src/core/interpreter.cpp
#include "matlabcpp/mechanics.hpp"

// Add to function registry:
if (func == "bending_stress") {
    // Parse 6 arguments
    return mechanics::bending_stress(M_z, y, I_z, M_y, z, I_y);
}
```

3. **Add help documentation:**
```matlab
>>> help bending_stress

BENDING_STRESS - Calculate bending stress in beam
  
  sigma = bending_stress(M_z, y, I_z, M_y, z, I_y)
  
  Calculates stress from biaxial bending:
    œÉ = -M_z*y/I_z + M_y*z/I_y
  
  Inputs:
    M_z : Bending moment about z-axis (N¬∑m)
    y   : Distance from z-axis (m)
    I_z : Second moment about z-axis (m‚Å¥)
    M_y : Bending moment about y-axis (N¬∑m)
    z   : Distance from y-axis (m)
    I_y : Second moment about y-axis (m‚Å¥)
  
  Output:
    sigma : Bending stress (Pa)
```

---

## Roadmap Position

```
v0.4.0 ‚úÖ Matrix system, debug, REPL
v0.4.1 ‚è≥ tic/toc, fprintf, scripts
v0.4.2 ‚è≥ QR/LU/SVD decompositions
v0.4.3 ‚è≥ Complex numbers
v0.4.4 ‚è≥ Mechanics module ‚Üê THIS
v0.4.5 ‚è≥ Optimization (fminunc)
v0.8.0 üéØ GPU acceleration
```

---

## Build Test Script

```bash
#!/bin/bash
# test_mechanics_v0.4.4.sh

echo "Testing v0.4.4 Mechanics Module..."

# Test 1: Bending stress
echo "bending_stress(1000, 0.1, 1e-4, 0, 0, 1)" | ./build/mlab++

# Test 2: Torsion
echo "torsion_rect(500, 0.05, 0.02)" | ./build/mlab++

# Test 3: Moment of inertia
echo "moment_inertia_rect(0.1, 0.2)" | ./build/mlab++

# Test 4: Von Mises
echo "von_mises(100, -50, 30)" | ./build/mlab++
```

---

## Status

**Version:** v0.4.4 (planned)  
**Priority:** Medium  
**Dependencies:** v0.4.0 complete  
**Estimated Time:** 2-3 hours implementation  
**Applications:** Structural analysis, FEA post-processing, beam calculations

---

## Real-World Use Case

```matlab
% Design check for steel beam
E = 200e9       % Pa (steel modulus)
sigma_y = 250e6 % Pa (yield stress)

% Beam geometry
L = 5           % m span
b = 0.2         % m width
h = 0.4         % m height

% Loading
w = 10e3        % N/m uniform load
M_max = w*L^2/8 % Maximum moment

% Section properties
I = moment_inertia_rect(b, h)

% Maximum stress (at extreme fiber)
y_max = h/2
sigma_max = bending_stress(M_max, y_max, I, 0, 0, 1)

% Safety factor
SF = sigma_y / abs(sigma_max)

fprintf('Maximum stress: %.1f MPa\n', sigma_max/1e6)
fprintf('Safety factor: %.2f\n', SF)

if SF < 1.5
    fprintf('Warning: Insufficient safety factor!\n')
end
```

---

**Ready to implement v0.4.4 mechanics module!** üèóÔ∏è
