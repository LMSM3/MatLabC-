# v0.4.X EXPERIMENT ROADMAP

**Goal:** Bridge v0.4.0 (CPU basic) → v0.8.0.1 (GPU full) with incremental releases

---

## Current State: v0.4.0 ✅

**What Works:**
- ✅ Basic matrix operations (+, -, *, .*)
- ✅ Matrix creation (randn, zeros, ones)
- ✅ 15+ scalar functions
- ✅ REPL with workspace
- ✅ Visual debugging (debug.cfg)

**What's Missing:**
- ❌ Script file execution (.m files)
- ❌ Complex numbers
- ❌ GPU operations
- ❌ Advanced decompositions (QR, LU, SVD)
- ❌ fprintf/tic/toc

---

## Experiment Series: v0.4.X

### v0.4.1 - REPL Enhancement (1-2 hours)
**Target:** Make stress tests runnable

**Add:**
- ✅ `fprintf()` - formatted output
- ✅ `tic`/`toc` - timing
- ✅ Script file execution (.m files)
- ✅ For loops (basic)
- ✅ If statements (basic)

**Result:** Can run `stress_matrix_parallel_cpu_only.m`

**Priority:** HIGH - Needed for automated testing

---

### v0.4.2 - Linear Algebra Core (2-3 hours)
**Target:** Add CPU decompositions

**Add:**
- ✅ `qr()` - QR decomposition (via Eigen)
- ✅ `lu()` - LU factorization
- ✅ `svd()` - Singular value decomposition
- ✅ `\` operator - Linear solve
- ✅ `norm()` - Matrix norms
- ✅ `eye()` - Identity matrix

**Result:** Can run full CPU baseline tests

**Priority:** HIGH - Needed for comparison

---

### v0.4.3 - Complex Numbers (3-4 hours)
**Target:** Complex arithmetic without GPU

**Add:**
- ✅ Complex literals `3+4i`
- ✅ Complex operations (+, -, *, /)
- ✅ `conj()`, `abs()`, `angle()`
- ✅ Complex QR/LU/SVD
- ✅ `real()`, `imag()`

**Result:** Full complex math on CPU

**Priority:** MEDIUM - Nice to have before GPU

---

### v0.4.4 - Preparation for GPU (1-2 hours)
**Target:** Add GPU stubs

**Add:**
- ✅ `gpu()` stub - returns CPU copy
- ✅ `cpu()` stub - no-op
- ✅ Device detection (reports "no GPU")
- ✅ Memory transfer simulation

**Result:** Scripts run but on CPU

**Priority:** LOW - Can skip to v0.8.0

---

## Recommended Path

### Path A: Quick to GPU (Skip v0.4.X)
```
v0.4.0 (NOW) → v0.8.0.1 (GPU build)
Time: 1-2 hours
Result: Full GPU support
```

### Path B: Incremental Testing
```
v0.4.0 → v0.4.1 (REPL) → v0.4.2 (LinAlg) → v0.8.0.1
Time: 4-6 hours total
Result: Tested at each step
```

### Path C: Full Features
```
v0.4.0 → v0.4.1 → v0.4.2 → v0.4.3 → v0.8.0.1
Time: 8-10 hours
Result: Complex CPU + GPU
```

---

## v0.4.1 Experiment (START HERE)

### Objective
Make stress tests runnable in current REPL

### Tasks
1. Add fprintf() support
2. Add tic/toc timing
3. Add .m file execution
4. Test with cpu_only scripts

### Implementation Plan

**File 1: Add to `src/active_window.cpp`**
```cpp
// In evaluate_expression():

// fprintf support
if (cmd.starts_with("fprintf")) {
    // Parse format string and args
    // Print to stdout
    return;
}

// tic/toc support
if (cmd == "tic") {
    timer_start = std::chrono::high_resolution_clock::now();
    return;
}

if (cmd == "toc") {
    auto timer_end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(
        timer_end - timer_start).count();
    std::cout << "Elapsed time: " << duration / 1000.0 << " seconds\n";
    return;
}
```

**File 2: Add to `src/main.cpp`**
```cpp
// In main():
if (argc == 2 && argv[1] ends with ".m") {
    // Read file
    std::ifstream file(argv[1]);
    std::string line;
    
    // Execute line by line
    while (std::getline(file, line)) {
        if (!line.empty() && line[0] != '%') {
            window.evaluate_expression(line);
        }
    }
    return 0;
}
```

### Test
```bash
# Build v0.4.1
cd build
cmake --build . -j$(nproc)

# Test
echo "fprintf('Test: %d\\n', 42); tic; A = randn(100,100); toc;" > test.m
./mlab++ test.m
```

**Expected output:**
```
Test: 42
Elapsed time: 0.005 seconds
```

---

## Quick Experiment NOW

**Test current v0.4.0 limits:**

```bash
cd /mnt/c/Users/Liam/Desktop/MatLabC++
./build/mlab++
```

Copy-paste:
```matlab
% Test 1: Matrix creation
N = 100
A = randn(N, N)

% Test 2: Basic ops (manual timing)
B = randn(N, N)
C = A + B
D = A * B

% Test 3: Check results
size(D)
mean(D(:))

% Test 4: Larger
N = 500
A = randn(N, N)
B = randn(N, N)
C = A * B
% Note how long this takes!

quit
```

**Measure with external timer:**
```bash
time ./build/mlab++ < tests/cpu_matrix_manual.txt
```

---

## Files to Create for v0.4.1

**Priority order:**
1. `src/repl_enhancements.cpp` - fprintf, tic, toc
2. `src/script_executor.cpp` - .m file support
3. `tests/test_v0.4.1.m` - Validation script
4. `V0.4.1_CHANGELOG.md` - What's new

---

## Decision Point

**Choose ONE:**

### Option 1: v0.4.1 Experiment (2 hours)
- Add fprintf/tic/toc
- Test automated scripts
- Stay on CPU

### Option 2: Skip to v0.8.0.1 (1-2 hours)
- Build with GPU
- Get full features immediately
- Skip intermediate steps

### Option 3: Manual Testing (NOW)
- Test v0.4.0 as-is
- Use manual timing
- Document limitations

---

**Recommendation:** Option 3 (manual test NOW), then Option 2 (GPU build)

**Why:** 
- v0.4.1-v0.4.3 are nice-to-have but not critical
- GPU build gives you everything
- Manual testing shows what works today

---

## Status

**Current:** v0.4.0 (CPU, basic, working)  
**Experiment:** v0.4.X series (incremental)  
**Target:** v0.8.0.1 (GPU, full power)  
**Recommendation:** Test NOW, then build GPU
